---
title: 浏览器事件循环机制
date: 2023-10-31 20:54:26
permalink: /pages/3b1a25/
categories:
  - 技术随笔
  - 技术随笔
tags:
  - 
---
## 0.前言

本篇博客主要为了阐述以下两个观点：

1. 单线程是异步产生的原因。
2. 事件循环 `eventloop` 是异步实现的方式。



## 1.单线程是异步产生的原因

- 因为不能是同步，只能是异步。

  `JS` 是一门单线程的语言，这是因为它运行在浏览器的渲染主线程中，而渲染主线程只有一个。渲染主线程中承担着诸多的工作，渲染页面、执行 `JS` 都在其中运行。如果使用同步的方式，就既有可能导致主线程产生阻塞，从而导致消息队列中的很多其他任务无法得到执行。

这种异步模式下，浏览器永不阻塞，从而最大限度的保证了单线程的流畅运行。



## 2. 事件循环是异步的实现方式。

- 浏览器是如何实现异步的——`message queue`

  具体的做法是：**当发生某些任务时，比如计时器、网络、事件监听，主线程将任务交给其他线程去处理，自身立即结束任务的执行，转而执行后续代码。当其他线程完成时，将事先传递的回调函数包装成任务，加入到消息队列的末尾排队，等待主线程调度执行。**

  上述的其他线程如下：

  1. 计时器线程。
  2. 网络线程。
  3. 事件监听线程。

- 事件循环/消息队列

  事件循环（`eventLoop` ）在`Chrome` 中又被称为消息循环，是浏览器渲染主线程的工作方式。

  在 `Chrome` 的源码中，它开启一个不会结束的 `for` 循环，每次循环从消息队列`message queue` 中取出第一个任务执行，而其他的线程只需要在核实的时候将任务加入到队列末尾即可。

  过去把消息队列简单分为 **宏任务** 和 **微任务**，这种说法目前已无法满足复杂的浏览器环境，取而代之的是一种更加灵活多变的处理方式。

  根据 `W3C` 官方的解释，每个任务有不同的类型， 同类型的任务必须在同一个队列，不同的任务可以属于不同的队列。不同任务队列有不同的优先级，**在一次事件循环中，由浏览器自行决定取哪一个队列的任务**。但浏览器必须有一个 **微队列** 。微队列的任务一定具有最高的优先级，必须优先调度执行。





## 3.参考

1. [渡一前端](https://ke.qq.com/webcourse/index.html)

