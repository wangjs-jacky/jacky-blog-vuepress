(window.webpackJsonp=window.webpackJsonp||[]).push([[96],{500:function(s,e,t){"use strict";t.r(e);var a=t(19),r=Object(a.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"_0-前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_0-前言"}},[s._v("#")]),s._v(" 0.前言")]),s._v(" "),t("p",[s._v("本文主要是梳理 "),t("code",[s._v("Javascript")]),s._v(" 语法解析器的发展历史。")]),s._v(" "),t("p",[s._v("希望阅读完本篇内容后，可以清楚以下 "),t("code",[s._v("parser")]),s._v(" 的逻辑")]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("AST")]),s._v(" 解析网址："),t("a",{attrs:{href:"https://astexplorer.net/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://astexplorer.net/"),t("OutboundLink")],1)])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://vblog-img.oss-cn-shanghai.aliyuncs.com/jacky-blog-vuepress/202310061511922.png",alt:"image-20231006151123442"}})]),s._v(" "),t("h2",{attrs:{id:"_1-ast-标准的发展历史"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-ast-标准的发展历史"}},[s._v("#")]),s._v(" 1. "),t("code",[s._v("AST")]),s._v(" 标准的发展历史")]),s._v(" "),t("p",[t("code",[s._v("Mozilla")]),s._v(" 在 "),t("code",[s._v("MDN")]),s._v(" 上公布了火狐浏览器的 "),t("code",[s._v("JS")]),s._v(" 引擎 "),t("code",[s._v("SpiderMonkey")]),s._v("（"),t("code",[s._v("c++")]),s._v(" 写的 "),t("code",[s._v("js")]),s._v(" 引擎）的 "),t("code",[s._v("parser api")]),s._v(" 和 "),t("code",[s._v("AST")]),s._v(" 标准，所以当时最早的 "),t("code",[s._v("JS parser")]),s._v(" ---- "),t("a",{attrs:{href:"https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fjquery%2Fesprima",target:"_blank",rel:"noopener noreferrer"}},[s._v("esprima"),t("OutboundLink")],1),s._v(" 就是基于 "),t("code",[s._v("SpiderMonkey")]),s._v(" 的 AST 标准来实现的，后来形成了 "),t("a",{attrs:{href:"https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Festree%2Festree",target:"_blank",rel:"noopener noreferrer"}},[s._v("estree 标准"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("div",{staticClass:"language-tsx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-tsx"}},[t("code",[s._v("SpiderMonkey "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AST")]),s._v(" 标准\n       ↓\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("JS")]),s._v(" parser "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" esprima   →  estree 标准\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("当然也不是所有的"),t("code",[s._v("js parser")]),s._v(" 都是 "),t("code",[s._v("estree")]),s._v(" 标准的，比如 "),t("code",[s._v("terser")]),s._v("、"),t("code",[s._v("typescript")]),s._v(" 等都有自己的 AST 标准。")]),s._v(" "),t("p",[s._v("关系如下图所示：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://vblog-img.oss-cn-shanghai.aliyuncs.com/jacky-blog-vuepress/202310061650998.png",alt:""}})]),s._v(" "),t("h2",{attrs:{id:"_2-纯-ecmascript-parser-解析器-esprima-和-acorn"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-纯-ecmascript-parser-解析器-esprima-和-acorn"}},[s._v("#")]),s._v(" 2.纯 "),t("code",[s._v("ECMAScript parser")]),s._v(" 解析器—— "),t("code",[s._v("Esprima")]),s._v(" 和 "),t("code",[s._v("acorn")])]),s._v(" "),t("ul",[t("li",[t("code",[s._v("ESprima")]),s._v(" ：最早的 "),t("code",[s._v("ECMAScript parser")]),s._v(" 的语法解析器，在早期支持绝对部分的 "),t("code",[s._v("ES6")]),s._v(" 的语法解析。当时很多的前端领域的工具都 基于 "),t("code",[s._v("esprima")]),s._v(" 开发的。")]),s._v(" "),t("li",[t("code",[s._v("acorn")]),s._v("：\n"),t("ul",[t("li",[s._v("但速度快于 "),t("code",[s._v("esprima")]),s._v(" 解析器。")]),s._v(" "),t("li",[s._v("支持插件化开发。")])])])]),s._v(" "),t("h2",{attrs:{id:"_3【eslint】解析器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3【eslint】解析器"}},[s._v("#")]),s._v(" 3【ESLint】解析器")]),s._v(" "),t("p",[s._v("预览：")]),s._v(" "),t("div",{staticClass:"language-typescript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-typescript"}},[t("code",[s._v("espree "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 内置解析器\n       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(" 版本：基于 esprima 封装\n       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),s._v(" 版本：基于 acorn 封装\n@babel"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("eslint"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("parser "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" babel 解析器\n@typescript"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("eslint"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("parser  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" ts 解析器\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"_3-1-espree-默认解析器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-espree-默认解析器"}},[s._v("#")]),s._v(" 3.1 "),t("code",[s._v("espree")]),s._v(" ——默认解析器")]),s._v(" "),t("p",[s._v("这是 "),t("code",[s._v("eslint")]),s._v(" 的默认 "),t("code",[s._v("parser")]),s._v("。")]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("2015")]),s._v(" 年之后，"),t("code",[s._v("es")]),s._v(" 标准一年一个版本，而 "),t("code",[s._v("esprima")]),s._v(" 的更新速度跟不上，它跟不上也就导致了依赖它的一系列工具都跟不上，所以 "),t("code",[s._v("eslint")]),s._v(" 就 "),t("code",[s._v("fork")]),s._v(" 了一份 "),t("code",[s._v("esprima")]),s._v("，做了一些扩展。")])]),s._v(" "),t("li",[t("p",[s._v("后期 "),t("code",[s._v("espree 2.0")]),s._v(" 基于 "),t("code",[s._v("acorn")]),s._v(" 重新实现了，也使用 "),t("code",[s._v("acorn")]),s._v(" 的插件机制来扩展语法。")])])]),s._v(" "),t("p",[s._v("使用方式：通过 "),t("code",[s._v("env")]),s._v(" 来设定 "),t("code",[s._v("ESlint")]),s._v(" 的默认 "),t("code",[s._v("ECMAScript parser")]),s._v(" 的版本。")]),s._v(" "),t("div",{staticClass:"language-tsx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-tsx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("module")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  env"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 支持浏览器环境")]),s._v("\n    browser"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 识别 CommonJS")]),s._v("\n    node"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 识别 ES 的代码，使用 ECMAScript 2021 自动设置 ecmaVersion parser 为 12，")]),s._v("\n    es2021"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("存在的问题："),t("a",{attrs:{href:"https://github.com/eslint/eslint/blob/a675c89573836adaf108a932696b061946abf1e6/README.md#what-about-experimental-features",target:"_blank",rel:"noopener noreferrer"}},[s._v("ESLint Github#exprerimental features"),t("OutboundLink")],1)]),s._v(" "),t("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://vblog-img.oss-cn-shanghai.aliyuncs.com/jacky-blog-vuepress/202310061700939.png",alt:"image-20231006162854342"}}),s._v(" "),t("h3",{attrs:{id:"_3-2-babel-eslint-parser"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-babel-eslint-parser"}},[s._v("#")]),s._v(" 3.2  "),t("code",[s._v("@babel/eslint-parser")])]),s._v(" "),t("p",[s._v("传统的 "),t("code",[s._v("espree")]),s._v(" 只能支持最新版本的 "),t("code",[s._v("ECMAScript")]),s._v(" 标准，不支持如下：")]),s._v(" "),t("ol",[t("li",[t("code",[s._v("stage-3")]),s._v(" "),t("code",[s._v("ECMAScript")]),s._v(" 标准。")]),s._v(" "),t("li",[s._v("语法特性，如 "),t("code",[s._v("jsx\\flow\\typescipt")])])]),s._v(" "),t("p",[s._v("此时可以 "),t("code",[s._v(".eslintrc.js")]),s._v(" ，切换为 "),t("code",[s._v("babel")]),s._v(" 解析器")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" i -D @babel/core @babel/eslint-parser\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("可通过 "),t("code",[s._v("parseOptions")]),s._v(" 配置解析器选项。具体内容如下:")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("ecmaVersion")]),s._v(": 这个配置和 "),t("code",[s._v("Acron")]),s._v(" 的 "),t("a",{attrs:{href:"https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Facornjs%2Facorn%2Ftree%2Fmaster%2Facorn",target:"_blank",rel:"noopener noreferrer"}},[s._v("ecmaVersion"),t("OutboundLink")],1),s._v(" 是兼容的，可以配置 "),t("code",[s._v("ES + 数字")]),s._v("(如 ES6)或者"),t("code",[s._v("ES + 年份")]),s._v("(如 ES2015)，也可以直接配置为"),t("code",[s._v("latest")]),s._v("，启用最新的 ES 语法。")]),s._v(" "),t("li",[t("code",[s._v("sourceType")]),s._v(": 默认为"),t("code",[s._v("script")]),s._v("，如果使用 "),t("code",[s._v("ES Module")]),s._v(" 则应设置为"),t("code",[s._v("module")])]),s._v(" "),t("li",[t("code",[s._v("ecmaFeatures")]),s._v(": 为一个对象，表示想使用的额外语言特性，如开启 "),t("code",[s._v("jsx")]),s._v("。")])]),s._v(" "),t("div",{staticClass:"language-tsx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-tsx"}},[t("code",[s._v("overrides"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 处理 JS 文件")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    files"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"**/*.{js,jsx}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 只处理 js 和 jsx 文件")]),s._v("\n    parser"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@babel/eslint-parser"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 使用 babel 来解析 js 文件")]),s._v("\n    parserOptions"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      sourceType"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"module"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 支持 import/export")]),s._v("\n      allowImportExportEverywhere"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      ecmaFeatures"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        globalReturn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h3",{attrs:{id:"_3-3-typescript-eslint-parser"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-typescript-eslint-parser"}},[s._v("#")]),s._v(" 3.3 "),t("code",[s._v("@typescript-eslint/parser")])]),s._v(" "),t("p",[s._v("同上，"),t("code",[s._v("espree")]),s._v(" 不支持 "),t("code",[s._v("typescript")]),s._v(" 语法，传统的做法，切换回 "),t("code",[s._v("typescript")]),s._v(" 进行语法支持。")]),s._v(" "),t("div",{staticClass:"language-tsx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-tsx"}},[t("code",[s._v("overrides"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 处理 TS 文件")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    files"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"**/*.{ts,tsx}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 只处理 ts 和 js 文件")]),s._v("\n    parser"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@typescript-eslint/parser"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 能看懂 TypeScript")]),s._v("\n    parserOptions"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      project"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./tsconfig.json"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// typescript-eslint 的推荐规则，只是这些最佳规则都是针对 TS 的")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"plugin:@typescript-eslint/recommended"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// tsconfig.json 里 Type Checking 的推荐规则")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"plugin:@typescript-eslint/recommended-requiring-type-checking"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    plugins"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 使用 typescript x eslint 的插件")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@typescript-eslint"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("h2",{attrs:{id:"_4-babel-parser"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-babel-parser"}},[s._v("#")]),s._v(" 4."),t("code",[s._v("@babel/parser")])]),s._v(" "),t("p",[t("code",[s._v("Babel")]),s._v(" 中有两个包可以用于解析 "),t("code",[s._v("JavaScript")]),s._v(" 代码，一个是 "),t("code",[s._v("@babel/parser")]),s._v("，另一个是 "),t("code",[s._v("babel-parser")]),s._v("（之前的名字是 "),t("code",[s._v("babylon")]),s._v("）。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("在 "),t("code",[s._v("babel 4")]),s._v(" 版本前，"),t("code",[s._v("babylon")]),s._v(" 基于 "),t("code",[s._v("acorn")]),s._v(" 进行开发，但后续已经看不到 "),t("code",[s._v("acorn")]),s._v(" 依赖，是直接通过 "),t("code",[s._v("fork")]),s._v(" 的 "),t("code",[s._v("acorn")]),s._v(" 进行修改。")])]),s._v(" "),t("li",[t("p",[s._v("在 "),t("code",[s._v("babel 7")]),s._v(" 版本以前，"),t("code",[s._v("babel")]),s._v(" 使用了 "),t("code",[s._v("Babylon")]),s._v(" 作为默认的 "),t("code",[s._v("Javascipt")]),s._v(" 解析器。但随着 "),t("code",[s._v("balylon")]),s._v("的停止维护，"),t("code",[s._v("babel")]),s._v(" 从 "),t("code",[s._v("7")]),s._v(" 版本开始推出了一个新的解析器 "),t("code",[s._v("@babel/parser")]),s._v(" 。")]),s._v(" "),t("p",[s._v("其中 "),t("code",[s._v("acorn")]),s._v(" 和 "),t("code",[s._v("babylon")]),s._v(" 都是由同一位开发人员创建，并且 "),t("code",[s._v("babylon")]),s._v(" 在某些情况下具有更好的性能和处理能力。")])]),s._v(" "),t("li",[t("p",[s._v("在"),t("code",[s._v("babel 7")]),s._v(" 版本后，"),t("code",[s._v("@babel/parser")]),s._v(" 是 "),t("code",[s._v("Babel")]),s._v(" 官方推荐的解析器，它是基于 "),t("code",[s._v("Acorn")]),s._v(" 解析器的一个 "),t("code",[s._v("fork")]),s._v(" 版本，支持最新的 "),t("code",[s._v("ECMAScript")]),s._v(" 标准，也支持 "),t("code",[s._v("JSX")]),s._v(" 和 "),t("code",[s._v("TypeScript")]),s._v("。")])])]),s._v(" "),t("p",[s._v("发展脉络如下：")]),s._v(" "),t("div",{staticClass:"language-tsx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-tsx"}},[t("code",[s._v("babel "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("     ← acorn 解析器\nbabel "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("   ← balyon 解析器（fork acorn 源码）\nbabel "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("     ← @babel"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("parser\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("其中，"),t("code",[s._v("@babel/parser")]),s._v(" 基于 "),t("code",[s._v("acorn")]),s._v(" 插件对 "),t("code",[s._v("estree AST")]),s._v(" 做了如下扩展：")]),s._v(" "),t("ul",[t("li",[s._v("把 "),t("code",[s._v("Literal")]),s._v(" 替换成了 "),t("code",[s._v("StringLiteral、NumericLiteral、 BigIntLiteral、 BooleanLiteral、 NullLiteral、 RegExpLiteral")])]),s._v(" "),t("li",[s._v("把 "),t("code",[s._v("Property")]),s._v(" 替换成了 "),t("code",[s._v("ObjectProperty")]),s._v(" 和 "),t("code",[s._v("ObjectMethod")])]),s._v(" "),t("li",[s._v("把 "),t("code",[s._v("MethodDefinition")]),s._v(" 替换成了"),t("code",[s._v("ClassMethod")])]),s._v(" "),t("li",[t("code",[s._v("Program")]),s._v(" 和 "),t("code",[s._v("BlockStatement")]),s._v(" 支持了 "),t("code",[s._v("directives")]),s._v(" 属性，也就是 "),t("code",[s._v("'use strict'")]),s._v("等指令的解析，对应的 "),t("code",[s._v("ast")]),s._v(" 是 "),t("code",[s._v("Directive")]),s._v(" 和 "),t("code",[s._v("DirectiveLiteral")])]),s._v(" "),t("li",[t("code",[s._v("ChainExpression")]),s._v(" 替换为了 "),t("code",[s._v("ObjectMemberExpression")]),s._v(" 和 "),t("code",[s._v("OptionalCallExpression")])]),s._v(" "),t("li",[t("code",[s._v("ImportExpression")]),s._v(" 替换为了 "),t("code",[s._v("CallExpression")]),s._v(" 并且 "),t("code",[s._v("callee")]),s._v(" 属性设置为 "),t("code",[s._v("Import")])])]),s._v(" "),t("blockquote",[t("p",[s._v("文档地址："),t("a",{attrs:{href:"https://babeljs.io/docs/babel-parser#output",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://babeljs.io/docs/babel-parser#output"),t("OutboundLink")],1)])]),s._v(" "),t("h2",{attrs:{id:"_3-总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-总结"}},[s._v("#")]),s._v(" 3.总结")]),s._v(" "),t("p",[s._v("这一节我们了解了 "),t("code",[s._v("ECMAScript parser")]),s._v(" 的历史，基于火狐浏览器的 JS 引擎 "),t("code",[s._v("SpiderMonkey")]),s._v(" 的 AST 标准，制定了 "),t("code",[s._v("espree")]),s._v(" 的标准，最早的 "),t("code",[s._v("estree")]),s._v(" 标准的实现是 "),t("code",[s._v("esprima")]),s._v("。")]),s._v(" "),t("p",[s._v("但是随着 "),t("code",[s._v("es2015")]),s._v(" 开始一年一个版本，"),t("code",[s._v("esprima")]),s._v(" 的迭代速度逐渐跟不上了，这时候 "),t("code",[s._v("acorn")]),s._v(" 流行起来，因为速度更快，而且支持插件扩展。")]),s._v(" "),t("p",[s._v("于是 "),t("code",[s._v("espree")]),s._v("、"),t("code",[s._v("babel parser(babylon)")]),s._v(" 等都基于 "),t("code",[s._v("acorn")]),s._v(" 来实现各自的 "),t("code",[s._v("parser")]),s._v("。虽然 "),t("code",[s._v("estree")]),s._v(" 系列的 "),t("code",[s._v("js parser")]),s._v(" 挺多的，但也不是全部，"),t("code",[s._v("terser、typescript")]),s._v(" 等都是用自己的 "),t("code",[s._v("AST")]),s._v("。")])])}),[],!1,null,null,null);e.default=r.exports}}]);