(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{475:function(s,n,a){"use strict";a.r(n);var e=a(19),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"_0-前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0-前言"}},[s._v("#")]),s._v(" 0.前言")]),s._v(" "),a("p",[s._v("本篇博客主要讲解的是如何将自己写的"),a("code",[s._v("module")]),s._v("发布到"),a("code",[s._v("npm")]),s._v("的官方仓库上。")]),s._v(" "),a("h2",{attrs:{id:"_1-具体步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-具体步骤"}},[s._v("#")]),s._v(" 1.具体步骤")]),s._v(" "),a("h3",{attrs:{id:"准备工作-一个账号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备工作-一个账号"}},[s._v("#")]),s._v(" 准备工作：一个账号")]),s._v(" "),a("p",[s._v("在发布公共 package 之前，需要在 "),a("a",{attrs:{href:"https://www.npmjs.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("npm 官网"),a("OutboundLink")],1),s._v("进行注册一个账号。")]),s._v(" "),a("p",[s._v("随后，在本地(需要发包的地方)执行命令 "),a("code",[s._v("npm login")]),s._v("，进行交互式操作并且登录。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ npm login\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"发包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#发包"}},[s._v("#")]),s._v(" 发包")]),s._v(" "),a("p",[s._v("发布一个 npm 包之前，填写 "),a("code",[s._v("package.json")]),s._v(" 中以下三项最重要的字段。假设此时包的名称为 "),a("code",[s._v("@shanyue/just-demo")])]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" '@shanyue/just-demo'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  version"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" '"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  main"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" './index.js'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("之后执行 "),a("code",[s._v("npm publish")]),s._v(" 发包即可。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" publish\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("一旦发布完成，在任意地方通过 "),a("code",[s._v("npm i")]),s._v(" 均可依赖该包。")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@shanyue/just-demo'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("如若该包进行更新后，需要再次发包，可 "),a("code",[s._v("npm version")]),s._v(" 控制该版本进行升级，记住需要遵守 "),a("a",{attrs:{href:"https://github.com/shfshanyue/Daily-Question/issues/534",target:"_blank",rel:"noopener noreferrer"}},[s._v("Semver 规范"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 增加一个修复版本号: 1.0.1 -> 1.0.2 (自动更改 package.json 中的 version 字段)")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version patch\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 增加一个小的版本号: 1.0.1 -> 1.1.0 (自动更改 package.json 中的 version 字段)")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version minor\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将更新后的包发布到 npm 中")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" publish\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"实际发包的内容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实际发包的内容"}},[s._v("#")]),s._v(" 实际发包的内容")]),s._v(" "),a("p",[s._v("在 npm 发包时，实际发包内容为 "),a("code",[s._v("package.json")]),s._v(" 中 "),a("code",[s._v("files")]),s._v(" 字段，一般只需将构建后资源(如果需要构建)进行发包，源文件可发可不发。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("{\n  files: ['dist']\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("若需要查看一个 package 的发包内容，可直接在 "),a("code",[s._v("node_modules/${package}")]),s._v(" 进行查看，将会发现它和源码有很大不同。也可以在 CDN 中进行查看，以 React 为例")]),s._v(" "),a("ol",[a("li",[s._v("jsdelivr: https://cdn.jsdelivr.net/npm/react/")]),s._v(" "),a("li",[s._v("unpkg: https://unpkg.com/browse/react/")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://wjs-tik.oss-cn-shanghai.aliyuncs.com/68747470733a2f2f63646e2e6a7364656c6976722e6e65742f67682f7368667368616e7975652f6173736574732f323032312d31312d32372f636c6970626f6172642d373234382e3466383234312e77656270.webp",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"发包的实际流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#发包的实际流程"}},[s._v("#")]),s._v(" 发包的实际流程")]),s._v(" "),a("p",[a("code",[s._v("npm publish")]),s._v(" 将自动走过以下生命周期")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("prepublishOnly")]),s._v(": 如果发包之前需要构建，可以放在这里执行")]),s._v(" "),a("li",[a("code",[s._v("prepack")])]),s._v(" "),a("li",[a("code",[s._v("prepare")]),s._v(": 如果发包之前需要构建，可以放在这里执行 (该周期也会在 npm i 后自动执行)")]),s._v(" "),a("li",[a("code",[s._v("postpack")])]),s._v(" "),a("li",[a("code",[s._v("publish")])]),s._v(" "),a("li",[a("code",[s._v("postpublish")])])]),s._v(" "),a("p",[s._v("发包实际上是将本地 "),a("code",[s._v("package")]),s._v(" 中的所有资源进行打包，并上传到 "),a("code",[s._v("npm")]),s._v(" 的一个过程。你可以通过 "),a("code",[s._v("npm pack")]),s._v(" 命令查看详情")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ npm pack\nnpm notice\nnpm notice 📦  midash@0.2.6\nnpm notice === Tarball Contents ===\nnpm notice 1.1kB  LICENSE\nnpm notice 812B   README.md\nnpm notice 5.7kB  dist/midash.cjs.development.js\nnpm notice 13.4kB dist/midash.cjs.development.js.map\nnpm notice 3.2kB  dist/midash.cjs.production.min.js\nnpm notice 10.5kB dist/midash.cjs.production.min.js.map\nnpm notice 5.3kB  dist/midash.esm.js\nnpm notice 13.4kB dist/midash.esm.js.map\nnpm notice 176B   dist/omit.d.ts\n......\nnpm notice === Tarball Details ===\nnpm notice name:          midash\nnpm notice version:       0.2.6\nnpm notice filename:      midash-0.2.6.tgz\nnpm notice package size:  11.5 kB\nnpm notice unpacked size: 67.8 kB\nnpm notice shasum:        c89d8c1aa96f78ce8b1dcf8f0f058fa7a6936a6a\nnpm notice integrity:     sha512-lyx8khPVkCHvH[...]kBL6K6VqOG6dQ==\nnpm notice total files:   46\nnpm notice\nmidash-0.2.6.tgz\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("p",[s._v("当你发包成功后，也可以前往 "),a("a",{attrs:{href:"https://npm.devtool.tech/react",target:"_blank",rel:"noopener noreferrer"}},[s._v("npm devtool"),a("OutboundLink")],1),s._v(" 查看各项数据。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://camo.githubusercontent.com/fbd2cc6c5c1a94d792ac1b26a9e439107990c252f7d3724a0c025596cb15270e/68747470733a2f2f63646e2e6a7364656c6976722e6e65742f67682f7368667368616e7975652f6173736574732f323032312d31312d32372f636c6970626f6172642d383733352e3965373632382e77656270",alt:"img"}})])])}),[],!1,null,null,null);n.default=t.exports}}]);