(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{435:function(t,e,v){"use strict";v.r(e);var _=v(19),a=Object(_.a)({},(function(){var t=this,e=t.$createElement,v=t._self._c||e;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h2",{attrs:{id:"_0-前言"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_0-前言"}},[t._v("#")]),t._v(" 0.前言")]),t._v(" "),v("p",[t._v("在转载文章"),v("a",{attrs:{href:"http://wjsheng_jacky.gitee.io/vblog/pages/ef2210",target:"_blank",rel:"noopener noreferrer"}},[t._v("《setTimeout和setImmediate到底谁先执行，本文让你彻底理解Event Loop》"),v("OutboundLink")],1),t._v("已经对EventLoop讲解的很通透了。")]),t._v(" "),v("p",[t._v("只是，文章在其中一小节 "),v("strong",[t._v("#JS异步是怎么实现的")]),t._v(" 仅举例说明了在"),v("strong",[t._v("浏览器中")]),t._v("是如何处理异步事件，而没有对"),v("code",[t._v("Node.js")]),t._v("做出详细的说明。")]),t._v(" "),v("p",[t._v("同时，根据蒋鹏飞的文章我们又了解到浏览器和 "),v("code",[t._v("Node")]),t._v(" 中的 "),v("code",[t._v("EventLoop")]),t._v("是不同的，这又是怎么回事吗？难道在"),v("code",[t._v("Node")]),t._v(" 除了"),v("code",[t._v("v8")]),t._v("引擎外，还封装了一个异步事件处理机制吗？")]),t._v(" "),v("p",[t._v("答案：是的。")]),t._v(" "),v("p",[t._v("实际上"),v("code",[t._v("Chrome")]),t._v("浏览器的异步实现机制是借助"),v("code",[t._v("V8")]),t._v("引擎的能力，而要介绍 "),v("code",[t._v("v8")]),t._v("引擎，又绕不开对 "),v("code",[t._v("Node.js")]),t._v(" 技术架构的分析。")]),t._v(" "),v("h2",{attrs:{id:"_1-node技术架构"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-node技术架构"}},[t._v("#")]),t._v(" 1.Node技术架构")]),t._v(" "),v("h3",{attrs:{id:"技术架构图"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#技术架构图"}},[t._v("#")]),t._v(" 技术架构图")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://wjs-tik.oss-cn-shanghai.aliyuncs.com/image-20220103160545098.png",alt:""}})]),t._v(" "),v("h3",{attrs:{id:"第一层-node-api"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#第一层-node-api"}},[t._v("#")]),t._v(" 第一层：Node API")]),t._v(" "),v("p",[t._v("在"),v("code",[t._v("Node.js")]),t._v("有许多官方实现的函数库，如"),v("code",[t._v("http")]),t._v("模块、"),v("code",[t._v("fs")]),t._v("文件读取模块、"),v("code",[t._v("stream")]),t._v("流模块等。")]),t._v(" "),v("p",[t._v("通过"),v("code",[t._v("Node.js")]),t._v("提供的标准库，我们很清晰的能够感觉到"),v("code",[t._v("Node")]),t._v("主要特性就是提供对数据流"),v("code",[t._v("异步")]),t._v("执行的方式。")]),t._v(" "),v("h3",{attrs:{id:"第二层-bindings-c"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#第二层-bindings-c"}},[t._v("#")]),t._v(" 第二层：bindings|C++")]),t._v(" "),v("p",[t._v("我们先来看下的场景：")]),t._v(" "),v("ol",[v("li",[t._v("现在市面上已经有一个"),v("code",[t._v("C/C++")]),t._v("实现的库"),v("code",[t._v("http_parser")]),t._v("，很高效。")]),t._v(" "),v("li",[t._v("我们只会"),v("code",[t._v("JS")]),t._v("，不会也不想学"),v("code",[t._v("JS")]),t._v("，但是又想拥有这个库的能力。")])]),t._v(" "),v("p",[t._v("那有没有办法能？有，就是通过这里的"),v("code",[t._v("bindings")]),t._v("实现的。")]),t._v(" "),v("p",[v("code",[t._v("Node.js bindings")]),t._v("是什么？它是连接JS和C/C++通信的一座桥梁。")]),t._v(" "),v("p",[t._v("即，我们既可以通过"),v("code",[t._v("JS")]),t._v("去调用"),v("code",[t._v("C++")]),t._v("代码，也可以在"),v("code",[t._v("C++")]),t._v("中使用"),v("code",[t._v("JS")]),t._v("代码。")]),t._v(" "),v("p",[v("strong",[t._v("参考资料：")])]),t._v(" "),v("ol",[v("li",[v("a",{attrs:{href:"http://nodejs.cn/api/addons.html#addons_function_arguments",target:"_blank",rel:"noopener noreferrer"}},[v("code",[t._v("JS")]),t._v("如何调用"),v("code",[t._v("C++")]),t._v("代码"),v("OutboundLink")],1)]),t._v(" "),v("li",[v("a",{attrs:{href:"http://nodejs.cn/api/addons.html#addons_callbacks",target:"_blank",rel:"noopener noreferrer"}},[v("code",[t._v("C++")]),t._v("调用"),v("code",[t._v("JS")]),t._v("回调"),v("OutboundLink")],1)])]),t._v(" "),v("h3",{attrs:{id:"第三层-见github-node-js-的deps目录"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#第三层-见github-node-js-的deps目录"}},[t._v("#")]),t._v(" 第三层：见github Node.js 的deps目录")]),t._v(" "),v("blockquote",[v("p",[t._v("这一层主要介绍"),v("code",[t._v("Node")]),t._v("的一些"),v("strong",[t._v("依赖库")]),t._v("，这里重点关注两个库："),v("code",[t._v("libuv")]),t._v(" 和 "),v("code",[t._v("v8")]),t._v("。")])]),t._v(" "),v("p",[v("strong",[t._v("Node.js v0.10/deps")])]),t._v(" "),v("p",[v("img",{attrs:{src:"https://wjs-tik.oss-cn-shanghai.aliyuncs.com/image-20220103162149632.png",alt:"image-20220103162149632"}})]),t._v(" "),v("h2",{attrs:{id:"_2-libuv和v8简介"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-libuv和v8简介"}},[t._v("#")]),t._v(" 2. libuv和v8简介")]),t._v(" "),v("h3",{attrs:{id:"libuv库"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#libuv库"}},[t._v("#")]),t._v(" libuv库")]),t._v(" "),v("p",[t._v("在不同系统上，对异步的实现是各不相同的，如：")]),t._v(" "),v("ul",[v("li",[v("p",[v("code",[t._v("FreeBSD")]),t._v("系统："),v("code",[t._v("kqueue")])])]),t._v(" "),v("li",[v("p",[v("code",[t._v("Linue")]),t._v("系统："),v("code",[t._v("epoll")])])]),t._v(" "),v("li",[v("p",[v("code",[t._v("Windows")]),t._v("系统："),v("code",[t._v("ICOP")])])])]),t._v(" "),v("p",[t._v("而"),v("code",[t._v("libuv")]),t._v("则是一个"),v("code",[t._v("跨平台")]),t._v("的异步"),v("code",[t._v("I/O")]),t._v("库，它会根据系统自动选择合适的方案。")]),t._v(" "),v("h3",{attrs:{id:"v8库"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#v8库"}},[t._v("#")]),t._v(" V8库")]),t._v(" "),v("p",[t._v("也就是"),v("code",[t._v("Chrome")]),t._v("浏览器内置的"),v("code",[t._v("JS解析器")]),t._v("，它除了可以执行JS外，可附带以下功能：")]),t._v(" "),v("ol",[v("li",[t._v("将JS源代码变为本地代码")]),t._v(" "),v("li",[t._v("维护调用栈，确保JS函数的执行顺序。")]),t._v(" "),v("li",[t._v("内存管理\n"),v("ul",[v("li",[t._v("给所有对象分配内存")]),t._v(" "),v("li",[t._v("垃圾回收：将不用的内存资源回收，再分配。")])])]),t._v(" "),v("li",[t._v("实现"),v("code",[t._v("JS")]),t._v("的标准库（第一层Node提供的"),v("code",[t._v("API")]),t._v("）")])]),t._v(" "),v("h2",{attrs:{id:"_3-eventloop"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-eventloop"}},[t._v("#")]),t._v(" 3.EventLoop")]),t._v(" "),v("p",[t._v("基于对"),v("code",[t._v("Node.js")]),t._v("技术架构分析。")]),t._v(" "),v("p",[v("code",[t._v("JS")]),t._v("的异步执行首先需要分清楚执行环境是："),v("code",[t._v("浏览器(V8)")]),t._v(" 还是 "),v("code",[t._v("Node")]),t._v("。")]),t._v(" "),v("ul",[v("li",[v("p",[t._v("在浏览器环境中，实际上调用的是"),v("code",[t._v("v8")]),t._v("中对异步的调用，可分为：")]),t._v(" "),v("ul",[v("li",[v("p",[v("code",[t._v("宏任务")]),t._v(": "),v("code",[t._v("macroTask")])])]),t._v(" "),v("li",[v("p",[v("code",[t._v("微任务")]),t._v(":"),v("code",[t._v("microTask")])]),t._v(" "),v("blockquote",[v("p",[t._v("PS：终于知道微软为啥叫"),v("code",[t._v("microsoft")]),t._v("了，记住"),v("code",[t._v("micro")]),t._v("前缀。")])])])])]),t._v(" "),v("li",[v("p",[t._v("而在Node环境中，虽然也集成了"),v("code",[t._v("v8")]),t._v("，但是"),v("code",[t._v("异步")]),t._v("处理使用的"),v("code",[t._v("libuv")]),t._v("的异步"),v("code",[t._v("I/O")]),t._v("跨平台实现，对不同的异步事件分的执行优先级区分更细，有六个阶段，这里与前端有关的主要有三个：")]),t._v(" "),v("p",[v("code",[t._v("timers(执行定时器回调)")]),t._v(" "),v("span",{staticClass:"katex"},[v("span",{staticClass:"katex-mathml"},[v("math",[v("semantics",[v("mrow",[v("mo",[t._v("→")])],1),v("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("\\rightarrow")])],1)],1)],1),v("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[v("span",{staticClass:"base"},[v("span",{staticClass:"strut",staticStyle:{height:"0.36687em","vertical-align":"0em"}}),v("span",{staticClass:"mrel"},[t._v("→")])])])]),t._v(" "),v("code",[t._v("poll(停留)")]),t._v(" "),v("span",{staticClass:"katex"},[v("span",{staticClass:"katex-mathml"},[v("math",[v("semantics",[v("mrow",[v("mo",[t._v("→")])],1),v("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("\\rightarrow")])],1)],1)],1),v("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[v("span",{staticClass:"base"},[v("span",{staticClass:"strut",staticStyle:{height:"0.36687em","vertical-align":"0em"}}),v("span",{staticClass:"mrel"},[t._v("→")])])])]),t._v(" "),v("code",[t._v("check(setImmediate)")])]),t._v(" "),v("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://pic3.zhimg.com/80/v2-69eca8db217343dd4ecf8b1bf2c255ca_1440w.jpg"}})])]),t._v(" "),v("h2",{attrs:{id:"_4-面试中常考的一道问题"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_4-面试中常考的一道问题"}},[t._v("#")]),t._v(" 4.面试中常考的一道问题")]),t._v(" "),v("p",[t._v("考题："),v("code",[t._v("setTimeout")]),t._v("与"),v("code",[t._v("setImmediate")]),t._v("到底谁快谁慢。")]),t._v(" "),v("p",[t._v("答：不确定，在同步函数执行阶段，我感觉"),v("code",[t._v("setTimeout")]),t._v("会快些(误：纯个人理解记忆) 。在回调函数等执行函数中，"),v("code",[t._v("setImmediate")]),t._v("快。")]),t._v(" "),v("blockquote",[v("p",[t._v("这一部分请详细看：转载文章《setTimeout和setImmediate到底谁先执行，本文让你彻底理解Event Loop》")])]),t._v(" "),v("h2",{attrs:{id:"_5-注意"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_5-注意"}},[t._v("#")]),t._v(" 5. 🚨注意")]),t._v(" "),v("ol",[v("li",[v("p",[t._v("Node不是一门后端编程语言，不是一个web框架")]),t._v(" "),v("p",[t._v("正确的表述："),v("code",[t._v("Node.js")]),t._v("是一个平台，让"),v("code",[t._v("JavaScript")]),t._v("能调用"),v("code",[t._v("系统接口")]),t._v("、"),v("code",[t._v("开发后端应用")]),t._v("。")])]),t._v(" "),v("li",[v("p",[t._v("Node中的线程知识补充：")]),t._v(" "),v("p",[t._v("我们知道浏览器中渲染进行可以分为以下线程")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/128265bfc2be4ede80c06927c6e78d0b~tplv-k3u1fbpfcp-watermark.awebp",alt:""}})]),t._v(" "),v("p",[t._v("那"),v("code",[t._v("V8")]),t._v("中与浏览器的线程的不同在于：")]),t._v(" "),v("ul",[v("li",[v("code",[t._v("V8")]),t._v("缺少"),v("code",[t._v("DOM API")]),t._v("，"),v("code",[t._v("DOM")]),t._v("是浏览器提供的。")])]),t._v(" "),v("p",[t._v("相同的在于：")]),t._v(" "),v("ul",[v("li",[v("code",[t._v("V8")]),t._v("执行"),v("code",[t._v("JS")]),t._v("是"),v("strong",[t._v("单线程")]),t._v("，本身多线程，如垃圾回收线程。")])])])]),t._v(" "),v("h2",{attrs:{id:"总结"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),v("p",[t._v("本篇博文主要是转载文章的补充，核心观点是：")]),t._v(" "),v("ul",[v("li",[t._v("浏览器的异步处理：取决于 "),v("code",[t._v("v8")])]),t._v(" "),v("li",[t._v("Node的异步处理：取决于"),v("code",[t._v("libuv")])])]),t._v(" "),v("h2",{attrs:{id:"补充资料-浏览器内核"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#补充资料-浏览器内核"}},[t._v("#")]),t._v(" 补充资料：浏览器内核")]),t._v(" "),v("p",[t._v("在本文中，默认"),v("code",[t._v("v8")]),t._v("是浏览器的内核其实是不严谨的，这边附上常见浏览器"),v("code",[t._v("JS")]),t._v("引擎和内核的列表(不完全)：")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",{staticStyle:{"text-align":"center"}},[t._v("公司")]),t._v(" "),v("th",{staticStyle:{"text-align":"center"}},[t._v("浏览器")]),t._v(" "),v("th",{staticStyle:{"text-align":"center"}},[t._v("JS引擎")]),t._v(" "),v("th",{staticStyle:{"text-align":"center"}},[t._v("渲染引擎")])])]),t._v(" "),v("tbody",[v("tr",[v("td",{staticStyle:{"text-align":"center"}},[t._v("Microsoft")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("IE6-8")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("JScritp")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("Trident")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"center"}}),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("IE9-11")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("Chakra")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("Trident")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"center"}}),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("Edge")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("Chakra")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("Edge")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"center"}},[t._v("Mozilla")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("Firefox")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("JagerMonkey")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("Gecko")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"center"}},[t._v("Google")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("Chrome")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("V8")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("Blink")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"center"}},[t._v("Apple")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("Safari")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("Webkit")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("SquirrelFish Extreme")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"center"}},[t._v("Opera")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("Opera12.16+")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("Blink")]),t._v(" "),v("td",{staticStyle:{"text-align":"center"}},[t._v("Carakan")])])])]),t._v(" "),v("h2",{attrs:{id:"参考资料"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),v("ol",[v("li",[v("p",[v("a",{attrs:{href:"http://wjsheng_jacky.gitee.io/vblog/pages/ef2210",target:"_blank",rel:"noopener noreferrer"}},[t._v("《setTimeout和setImmediate到底谁先执行，本文让你彻底理解Event Loop》"),v("OutboundLink")],1)])]),t._v(" "),v("li",[v("p",[v("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/34924059",target:"_blank",rel:"noopener noreferrer"}},[t._v("饥人谷-方应杭：《EventLoop、计时器、nextTick》"),v("OutboundLink")],1)])])])])}),[],!1,null,null,null);e.default=a.exports}}]);