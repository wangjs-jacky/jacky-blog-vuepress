(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{442:function(t,s,a){"use strict";a.r(s);var n=a(19),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"_0-前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0-前言"}},[t._v("#")]),t._v(" 0.前言")]),t._v(" "),a("p",[t._v("本篇博客主要针对的是"),a("code",[t._v("Web")]),t._v("性能优化的基础理论知识，"),a("code",[t._v("HTML")]),t._v("资源是以何种方式何种顺序被加载到浏览器中的。")]),t._v(" "),a("h2",{attrs:{id:"_1-html的解析过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-html的解析过程"}},[t._v("#")]),t._v(" 1.HTML的解析过程")]),t._v(" "),a("p",[t._v("假设现在有一个"),a("code",[t._v("index.html")]),t._v("资源：")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("stylesheet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("text/css"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("./*.css"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("h1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("你好"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("h1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 加载外部资源 --\x3e")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("    \n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 边下载边解析 --\x3e")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("text/javascript"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n\t\tdocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello World!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("更多内容..."),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br")])]),a("p",[a("code",[t._v("HTML")]),t._v(" 解析过程如下：")]),t._v(" "),a("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://wjs-tik.oss-cn-shanghai.aliyuncs.com/image-20220224230257143.png",alt:"image-20220224230257143"}}),t._v(" "),a("ul",[a("li",[a("p",[t._v("边下载边解析"),a("code",[t._v("HTML")]),t._v("，以下均是"),a("code",[t._v("HTML")]),t._v("的解析过程：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("解析到："),a("code",[t._v('<link rel="stylesheet" type="text/css" href="./*.css" />')])]),t._v(" "),a("p",[t._v("于是开始去边下载边解析"),a("code",[t._v("css")]),t._v("资源")]),t._v(" "),a("blockquote",[a("p",[t._v("css的解析和下载并不会阻塞"),a("code",[t._v("HTML")]),t._v("的解析过程。")])])]),t._v(" "),a("li",[a("p",[t._v("解析到："),a("code",[t._v("<h1>你好</h1>")]),t._v("，开始构建"),a("code",[t._v("DOM tree")])])]),t._v(" "),a("li",[a("p",[t._v("解析到："),a("code",[t._v('<script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js"><\/script>')])]),t._v(" "),a("ul",[a("li",[t._v("开始下载"),a("code",[t._v("cdn")]),t._v("资源，下载后执行"),a("code",[t._v("javascript")]),t._v("。")])]),t._v(" "),a("blockquote",[a("p",[t._v("🚨注意：此时"),a("code",[t._v("javascript")]),t._v("的下载和执行会阻塞"),a("code",[t._v("HTML")]),t._v("的解析")])])]),t._v(" "),a("li",[a("p",[t._v("解析到："),a("code",[t._v("<div>更多内容...</div>")]),t._v("，此时解析结束。")])])])])]),t._v(" "),a("h2",{attrs:{id:"_2-html解析被js阻塞的原因"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-html解析被js阻塞的原因"}},[t._v("#")]),t._v(" 2.HTML解析被JS阻塞的原因")]),t._v(" "),a("p",[t._v("以上"),a("code",[t._v("HTML")]),t._v("的解析过程会被两个行为阻塞：")]),t._v(" "),a("ol",[a("li",[a("p",[a("code",[t._v("JS")]),t._v("的下载过程：")]),t._v(" "),a("p",[t._v("在早期浏览器中并不会处理此类阻塞，原因是：浏览器偷懒了，性价比不高。整个"),a("code",[t._v("HTML")]),t._v("解析过程可能只有"),a("code",[t._v("1ms")]),t._v("，而下载过程需要"),a("code",[t._v("100ms")]),t._v("，对性能的提升不大。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("JS")]),t._v("的执行过程：")]),t._v(" "),a("p",[t._v("原因是可能执行过程中遇到以下代码：")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("text/javascript"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n  document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello World!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("即，"),a("code",[t._v("JS")]),t._v("的操作可能会修改"),a("code",[t._v("DOM")]),t._v("树的构建，如果"),a("code",[t._v("HTML")]),t._v("不能"),a("code",[t._v("JS")]),t._v("执行结束，就直接解析出"),a("code",[t._v("DOM")]),t._v("树，会存在"),a("code",[t._v("DOM")]),t._v("树构建失败。")])])]),t._v(" "),a("h2",{attrs:{id:"_3-async与defer的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-async与defer的区别"}},[t._v("#")]),t._v(" 3."),a("code",[t._v("async")]),t._v("与"),a("code",[t._v("defer")]),t._v("的区别")]),t._v(" "),a("p",[t._v("通过设置"),a("code",[t._v("async")]),t._v("和"),a("code",[t._v("defer")]),t._v("属性可以将"),a("code",[t._v("JS")]),t._v("的下载，独立出"),a("code",[t._v("HTML")]),t._v("的解析，并且对"),a("code",[t._v("JS")]),t._v("的执行顺序也可以控制。")]),t._v(" "),a("p",[t._v("对于"),a("code",[t._v("script")]),t._v("可以设置如下标签：")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("defer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("async")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("async")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("下图为不同"),a("code",[t._v("script")]),t._v("属性值下的执行流程图：")]),t._v(" "),a("blockquote",[a("p",[t._v("其中，绿线代表"),a("code",[t._v("HTML")]),t._v("解析过程，蓝线代表"),a("code",[t._v("JS下载")]),t._v("，红线代表"),a("code",[t._v("JS执行")])])]),t._v(" "),a("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://wjs-tik.oss-cn-shanghai.aliyuncs.com/image-20220224234128784.png"}}),t._v(" "),a("p",[t._v("从上图中可以得知："),a("code",[t._v("async")]),t._v("和"),a("code",[t._v("defer")]),t._v("作用都是不让"),a("code",[t._v("JS下载")]),t._v("阻塞"),a("code",[t._v("HTML")]),t._v("执行。")]),t._v(" "),a("p",[t._v("两者的区别在于：下载后"),a("code",[t._v("JS")]),t._v("的执行顺序")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("async")]),t._v("：这个属性只有一个原则，即一旦下载结束就立即执行"),a("code",[t._v("js")]),t._v("文件。")]),t._v(" "),a("p",[t._v("上图中存在一个问题，看上去"),a("code",[t._v("async")]),t._v("会阻塞"),a("code",[t._v("HTML")]),t._v("解析，但是实际上"),a("code",[t._v("fetch")]),t._v("的下载要远远长于"),a("code",[t._v("HTML")]),t._v("的解析流程。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("defer")]),t._v("：推荐使用，因为 "),a("code",[t._v("async")]),t._v(" 并不能保证 "),a("code",[t._v("js")]),t._v(" 代码的执行顺序，执行顺序取决于网络下载情况，此时"),a("code",[t._v("JS")]),t._v("执行顺序会比较松散，而 "),a("code",[t._v("defer")]),t._v(" 的执行顺序，取决于定义代码的位置。并且在 "),a("code",[t._v("HTML")]),t._v(" 解析后执行。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("module")]),t._v("：过程基本等同于"),a("code",[t._v("defer")]),t._v("，衍生出的其余蓝线是包依赖的"),a("code",[t._v("modules")]),t._v("。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("module")]),t._v("+"),a("code",[t._v("async")]),t._v("：依赖结束后，直接执行。")])])]),t._v(" "),a("h2",{attrs:{id:"_4-如何区分prefetch与preload"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-如何区分prefetch与preload"}},[t._v("#")]),t._v(" 4.如何区分"),a("code",[t._v("prefetch")]),t._v("与"),a("code",[t._v("preload")])]),t._v(" "),a("p",[t._v("这两个标签的作用是：让浏览器提前加载指定资源(与"),a("code",[t._v("defer")]),t._v("等字段不同的是："),a("code",[t._v("加载后并不执行")]),t._v(")，在需要执行的时候再执行。优点是：")]),t._v(" "),a("ol",[a("li",[t._v("将加载和执行分离开，不会阻塞"),a("code",[t._v("HTML")]),t._v("渲染和"),a("code",[t._v("document")]),t._v("的"),a("code",[t._v("onload")]),t._v("事件。")]),t._v(" "),a("li",[t._v("提前加载指定资源，不再出现依赖的"),a("code",[t._v("font")]),t._v("字体隔了一段时间才刷出。")])]),t._v(" "),a("p",[t._v("使用方式：")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 使用 link 标签静态标记需要预加载的资源 --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("preload"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("/path/to/style.css"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("as")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("style"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 或使用脚本动态创建一个 link 标签后插入到 head 头部 --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" link "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'link'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nlink"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rel "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'preload'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nlink"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("as "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'style'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nlink"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("href "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/path/to/style.css'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("head"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("link"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("p",[a("code",[t._v("preload")]),t._v(" 和 "),a("code",[t._v("prefetch")]),t._v("的应用场景：")]),t._v(" "),a("ol",[a("li",[a("p",[a("code",[t._v("preload")]),t._v(" 是告诉浏览器页面"),a("strong",[t._v("必定")]),t._v("需要的资源，浏览器"),a("strong",[t._v("一定会")]),t._v("加载这些资源。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("prefetch")]),t._v("是告诉浏览器页面"),a("strong",[t._v("可能")]),t._v("需要的资源，浏览器"),a("strong",[t._v("不一定会")]),t._v("加载这些资源。")]),t._v(" "),a("p",[t._v("如，某一场景下，页面加载后会初始化首屏组件，当用户滚动页面时，会拉取第二屏的组件，若能预测用户行为，则可以 "),a("code",[t._v("prefetch")]),t._v(" 下一屏的组件。")])])]),t._v(" "),a("p",[t._v("由此引出另一话题，资源的加载是存在优先级的，具体的请看："),a("a",{attrs:{href:"https://juejin.cn/post/6844903562070196237",target:"_blank",rel:"noopener noreferrer"}},[t._v("蚂蚁金服数据体验技术"),a("OutboundLink")],1),t._v("出的文章。")]),t._v(" "),a("h2",{attrs:{id:"_5-页面渲染机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-页面渲染机制"}},[t._v("#")]),t._v(" 5.页面渲染机制")]),t._v(" "),a("p",[t._v("以下内容来源于："),a("a",{attrs:{href:"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/constructing-the-object-model",target:"_blank",rel:"noopener noreferrer"}},[t._v("Web Fundamentals"),a("OutboundLink")],1)]),t._v(" "),a("ol",[a("li",[a("code",[t._v("HTML")]),t._v("结构如下：")])]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token doctype"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),a("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("DOCTYPE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("viewport"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("width=device-width,initial-scale=1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("style.css"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("stylesheet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Critical Path"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Hello "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("span")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("web performance"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("span")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" students!"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("p")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("img")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("awesome-photo.jpg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[a("p",[t._v("第1步，根据"),a("code",[t._v("HTML")]),t._v("文件，边下载边构建 "),a("code",[t._v("DOM")]),t._v(" 树。（且会被"),a("code",[t._v("js")]),t._v("下载和执行阻塞）")]),t._v(" "),a("img",{staticStyle:{zoom:"33%"},attrs:{src:"https://wjs-tik.oss-cn-shanghai.aliyuncs.com/image-20220225002930480.png"}}),t._v(" "),a("p",[a("code",[t._v("Chrome-dev-tools")]),t._v(" 流程图如下：此阶段为"),a("code",[t._v("parse HTML")])]),t._v(" "),a("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://wjs-tik.oss-cn-shanghai.aliyuncs.com/image-20220225003041972.png"}}),t._v(" "),a("p",[t._v("在控制台输入")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("document\nconsole.dir"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("第2步，边下载边构建 "),a("code",[t._v("CSSOM")]),t._v(" 树，"),a("code",[t._v("css")]),t._v("文件和"),a("code",[t._v("CSSOM")]),t._v("树如下图所示：")]),t._v(" "),a("div",{staticClass:"language-css line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-css"}},[a("code",[a("span",{pre:!0,attrs:{class:"token selector"}},[t._v("body")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("font-size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 16px "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token selector"}},[t._v("p")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("font-weight")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" bold "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token selector"}},[t._v("span")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("color")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" red "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token selector"}},[t._v("p span")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("display")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" none "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token selector"}},[t._v("img")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("float")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" right "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("可以发现，"),a("code",[t._v("font-size")]),t._v("有传导的作用")]),t._v(" "),a("img",{staticStyle:{zoom:"33%"},attrs:{src:"https://wjs-tik.oss-cn-shanghai.aliyuncs.com/image-20220225003225967.png"}})]),t._v(" "),a("li",[a("p",[t._v("根据"),a("code",[t._v("DOM")]),t._v("和"),a("code",[t._v("CSSOM")]),t._v("生成 "),a("code",[t._v("render tree")]),t._v(" 渲染树计算（"),a("code",[t._v("Recalculate Style")]),t._v(" 阶段）")]),t._v(" "),a("p",[t._v("注意：这里渲染树只会计算所有在页面上可见的 "),a("code",[t._v("DOM")]),t._v(" 内容，以及每个"),a("code",[t._v("node")]),t._v("上的"),a("code",[t._v("CSSOM")]),t._v("样式。")]),t._v(" "),a("img",{staticStyle:{zoom:"33%"},attrs:{src:"https://wjs-tik.oss-cn-shanghai.aliyuncs.com/image-20220225020721898.png"}})]),t._v(" "),a("li",[a("p",[t._v("以上结束后，触发 "),a("code",[t._v("DOMContentLoaded")]),t._v(" 事件，说明"),a("code",[t._v("render tree")]),t._v("已经准备就绪，可以开始渲染。")])]),t._v(" "),a("li",[a("p",[t._v("页面渲染，即如何将 "),a("code",[t._v("render tree")]),t._v("转化为屏幕上的真实"),a("code",[t._v("pixels")])]),t._v(" "),a("img",{staticStyle:{zoom:"33%"},attrs:{src:"https://wjs-tik.oss-cn-shanghai.aliyuncs.com/image-20220225014629603.png"}}),t._v(" "),a("blockquote",[a("p",[t._v("三个阶段："),a("code",[t._v("layout")]),t._v("、"),a("code",[t._v("paint")]),t._v("、"),a("code",[t._v("composite")])]),t._v(" "),a("ol",[a("li",[a("p",[t._v("有了渲染树后，进入布局阶段("),a("code",[t._v("layout")]),t._v(")")]),t._v(" "),a("p",[t._v("布局阶段：会计算相对于视口的位置，大小和尺寸。")])]),t._v(" "),a("li",[a("p",[t._v("布局完成后，浏览器会立即发出“"),a("code",[t._v("Paint")]),t._v("”事件，将渲染树转换成屏幕上的像素。")])]),t._v(" "),a("li",[a("p",[t._v("图层树计算，进入"),a("code",[t._v("composite")]),t._v("阶段。")])])]),t._v(" "),a("p",[t._v("对应的"),a("code",[t._v("Chrome-dev-tools")]),t._v("显示有："),a("a",{attrs:{href:"https://googlesamples.github.io/web-fundamentals/fundamentals/performance/critical-rendering-path/nested.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Try it"),a("OutboundLink")],1)]),t._v(" "),a("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://wjs-tik.oss-cn-shanghai.aliyuncs.com/image-20220225100404516.png"}}),t._v(" "),a("p",[t._v("下面的结果是错的（忘记关插件了.......）")]),t._v(" "),a("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://wjs-tik.oss-cn-shanghai.aliyuncs.com/image-20220225021443185.png"}})])])]),t._v(" "),a("h2",{attrs:{id:"_6-如何判定-reflow-和-repaint"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-如何判定-reflow-和-repaint"}},[t._v("#")]),t._v(" 6.如何判定 "),a("code",[t._v("reflow")]),t._v(" 和 "),a("code",[t._v("repaint")])]),t._v(" "),a("p",[t._v("对性能影响最大的是页面内容的渲染，大部分我们只考虑 "),a("code",[t._v("Layout")]),t._v("阶段，和 "),a("code",[t._v("Paint")]),t._v(" 阶段。")]),t._v(" "),a("p",[a("code",[t._v("Layout")]),t._v(" 阶段的修改："),a("code",[t._v("reflow")]),t._v("回流。")]),t._v(" "),a("p",[a("code",[t._v("Paint")]),t._v(" 阶段的修改："),a("code",[t._v("repaint")]),t._v("重绘。")]),t._v(" "),a("p",[t._v("而"),a("code",[t._v("Composite")]),t._v("阶段，只要页面被修改了则必定会触发，一般不会考虑此阶段的性能优化。")]),t._v(" "),a("p",[t._v("这里的优化方案如下：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("通过查阅 "),a("a",{attrs:{href:"https://csstriggers.com",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("csstrigger")]),t._v("网站"),a("OutboundLink")],1),t._v("，查阅不同的 "),a("code",[t._v("css")]),t._v(" 样式，会触发的"),a("code",[t._v("Layout")]),t._v("、"),a("code",[t._v("Paint")]),t._v("、"),a("code",[t._v("Composite")]),t._v("的影响。")]),t._v(" "),a("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://wjs-tik.oss-cn-shanghai.aliyuncs.com/image-20220225094031828.png"}}),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("浏览器内核")]),t._v(" "),a("th",[t._v("渲染引擎")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("IE")]),t._v(" "),a("td",[t._v("Trident")])]),t._v(" "),a("tr",[a("td",[t._v("Firefox")]),t._v(" "),a("td",[t._v("Gecko")])]),t._v(" "),a("tr",[a("td",[t._v("Safari")]),t._v(" "),a("td",[t._v("Webkit")])]),t._v(" "),a("tr",[a("td",[t._v("Chrome")]),t._v(" "),a("td",[t._v("Blink（WebKit 的分支）")])]),t._v(" "),a("tr",[a("td",[t._v("Opera")]),t._v(" "),a("td",[t._v("原为 Presto，现为 Blink")])])])]),t._v(" "),a("p",[t._v("这里还有一个需要关注："),a("code",[t._v("Change from default")]),t._v(" 。上面介绍浏览器的渲染机制的时候其实忽略了一点就是，其实浏览器内部已经存在一套默认的样式了，我们的"),a("code",[t._v("CSS")]),t._v("文件只是对原有样式的一层覆盖和修改。")])]),t._v(" "),a("li",[a("p",[t._v("选择对页面渲染影响较小的 "),a("code",[t._v("css")]),t._v(" 样式，如：将 "),a("code",[t._v("left")]),t._v(" 样式改为"),a("code",[t._v("transform")]),t._v("样式。")]),t._v(" "),a("p",[a("code",[t._v("transform")]),t._v("：")]),t._v(" "),a("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://wjs-tik.oss-cn-shanghai.aliyuncs.com/image-20220225093738383.png"}}),t._v(" "),a("p",[a("code",[t._v("left")]),t._v("：")]),t._v(" "),a("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://wjs-tik.oss-cn-shanghai.aliyuncs.com/image-20220225093808793.png"}}),t._v(" "),a("p",[t._v("在 "),a("code",[t._v("Chrome")]),t._v(" 和 "),a("code",[t._v("Firefox")]),t._v(" 中，修改以上属性可以提高页面的渲染性能。")])])]),t._v(" "),a("h2",{attrs:{id:"_7-vscode-插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-vscode-插件"}},[t._v("#")]),t._v(" 7. VSCode 插件")]),t._v(" "),a("p",[t._v("推荐："),a("code",[t._v("css-triggers")]),t._v(" VSCode 插件，"),a("a",{attrs:{href:"https://marketplace.visualstudio.com/items?itemName=kisstkondoros.csstriggers",target:"_blank",rel:"noopener noreferrer"}},[t._v("插件下载地址"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"_8-总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-总结"}},[t._v("#")]),t._v(" 8.总结")]),t._v(" "),a("p",[a("code",[t._v("Webkit")]),t._v(" 主流程，已经可以很好的概括本篇博客的内容了。")]),t._v(" "),a("center",[a("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://wjs-tik.oss-cn-shanghai.aliyuncs.com/image-20220225100749425.png"}})])],1)}),[],!1,null,null,null);s.default=e.exports}}]);